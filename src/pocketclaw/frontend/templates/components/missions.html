<!--
  PocketPaw Dashboard - Crew View (Control Room)

  Created: 2026-02-05
  Updated: 2026-02-05 - Added task execution with Run/Stop buttons and live output panel

  Linear-inspired project management dashboard for multi-agent orchestration.
  Provides real-time visibility into what agents are doing.

  Features:
  - Run button on task cards to execute with assigned agent
  - Live output streaming during task execution
  - Running indicator with animated pulse
  - Stop button to cancel running tasks
-->
<!-- Missions View -->
<div class="flex-1 flex flex-col pt-20 overflow-hidden" x-show="view === 'missions'" x-cloak>

    <!-- Loading State -->
    <div x-show="missionControl.loading" class="flex-1 flex items-center justify-center">
        <div class="flex flex-col items-center gap-4 text-white/50">
            <div class="w-8 h-8 border-2 border-accent/30 border-t-accent rounded-full animate-spin"></div>
            <span class="text-sm">Loading Crew...</span>
        </div>
    </div>

    <!-- Main Content -->
    <div x-show="!missionControl.loading" class="flex-1 flex flex-col overflow-hidden">

        <!-- Compact Stats Bar -->
        <div class="flex items-center justify-between px-6 py-3 border-b border-white/5 bg-black/20">
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    <span class="text-xs text-white/40 uppercase tracking-wider">Live</span>
                </div>
                <div class="flex items-center gap-4 text-sm">
                    <span class="text-white/70"><span class="text-white font-semibold" x-text="missionControl.stats.total_agents || 0"></span> agents</span>
                    <span class="text-white/30">·</span>
                    <span class="text-white/70"><span class="text-white font-semibold" x-text="missionControl.stats.active_tasks || 0"></span> active</span>
                    <span class="text-white/30">·</span>
                    <span class="text-white/70"><span class="text-white font-semibold" x-text="missionControl.stats.completed_today || 0"></span> done today</span>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button
                    class="flex items-center gap-2 px-3 py-1.5 text-xs font-medium text-white/70 hover:text-white bg-white/5 hover:bg-white/10 rounded-lg transition-all"
                    @click="missionControl.showCreateTask = true"
                >
                    <i data-lucide="plus" class="w-3.5 h-3.5"></i>
                    <span>New Task</span>
                </button>
                <button
                    class="flex items-center gap-2 px-3 py-1.5 text-xs font-medium text-white/70 hover:text-white bg-white/5 hover:bg-white/10 rounded-lg transition-all"
                    @click="missionControl.showCreateAgent = true"
                >
                    <i data-lucide="user-plus" class="w-3.5 h-3.5"></i>
                    <span>New Agent</span>
                </button>
            </div>
        </div>

        <!-- Two Column Layout -->
        <div class="flex-1 flex overflow-hidden">

            <!-- Left: Tasks Panel -->
            <div class="flex-1 flex flex-col border-r border-white/5 min-w-0">

                <!-- Task Filters -->
                <div class="flex items-center gap-1 px-4 py-2 border-b border-white/5">
                    <button
                        class="px-3 py-1 rounded-md text-xs font-medium transition-all"
                        :class="missionControl.taskFilter === 'all' ? 'bg-white/10 text-white' : 'text-white/40 hover:text-white/70'"
                        @click="missionControl.taskFilter = 'all'"
                    >All</button>
                    <button
                        class="px-3 py-1 rounded-md text-xs font-medium transition-all flex items-center gap-1.5"
                        :class="missionControl.taskFilter === 'in_progress' ? 'bg-amber-500/20 text-amber-400' : 'text-white/40 hover:text-white/70'"
                        @click="missionControl.taskFilter = 'in_progress'"
                    >
                        <span class="w-1.5 h-1.5 rounded-full bg-amber-500"></span>
                        In Progress
                    </button>
                    <button
                        class="px-3 py-1 rounded-md text-xs font-medium transition-all flex items-center gap-1.5"
                        :class="missionControl.taskFilter === 'inbox' ? 'bg-blue-500/20 text-blue-400' : 'text-white/40 hover:text-white/70'"
                        @click="missionControl.taskFilter = 'inbox'"
                    >
                        <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span>
                        Inbox
                    </button>
                    <button
                        class="px-3 py-1 rounded-md text-xs font-medium transition-all flex items-center gap-1.5"
                        :class="missionControl.taskFilter === 'done' ? 'bg-green-500/20 text-green-400' : 'text-white/40 hover:text-white/70'"
                        @click="missionControl.taskFilter = 'done'"
                    >
                        <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                        Done
                    </button>
                </div>

                <!-- Task List -->
                <div class="flex-1 overflow-y-auto">
                    <!-- Empty State -->
                    <div x-show="filteredMCTasks.length === 0" class="flex flex-col items-center justify-center h-full text-white/30 p-8">
                        <i data-lucide="inbox" class="w-12 h-12 mb-4 opacity-40"></i>
                        <p class="text-sm font-medium">No tasks yet</p>
                        <p class="text-xs mt-1">Create a task to get your agents working</p>
                        <button
                            class="mt-4 flex items-center gap-2 px-4 py-2 text-sm font-medium text-accent bg-accent/10 hover:bg-accent/20 rounded-lg transition-all"
                            @click="missionControl.showCreateTask = true"
                        >
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            Create Task
                        </button>
                    </div>

                    <!-- Task Items -->
                    <template x-for="task in filteredMCTasks" :key="task.id">
                        <div
                            class="group flex items-start gap-3 px-4 py-3 border-b border-white/5 hover:bg-white/[0.02] cursor-pointer transition-all"
                            @click="selectMCTask(task)"
                            :class="missionControl.selectedTask?.id === task.id ? 'bg-white/[0.04] border-l-2 border-l-accent' : ''"
                        >
                            <!-- Status Indicator -->
                            <div class="mt-1">
                                <div
                                    class="w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all"
                                    :class="{
                                        'border-blue-500/50 bg-blue-500/10': task.status === 'inbox',
                                        'border-cyan-500/50 bg-cyan-500/10': task.status === 'assigned',
                                        'border-amber-500 bg-amber-500/20': task.status === 'in_progress',
                                        'border-purple-500/50 bg-purple-500/10': task.status === 'review',
                                        'border-green-500 bg-green-500/20': task.status === 'done',
                                        'border-red-500/50 bg-red-500/10': task.status === 'blocked'
                                    }"
                                >
                                    <i x-show="task.status === 'done'" data-lucide="check" class="w-2.5 h-2.5 text-green-500"></i>
                                    <div x-show="task.status === 'in_progress'" class="w-1.5 h-1.5 rounded-full bg-amber-500 animate-pulse"></div>
                                </div>
                            </div>

                            <!-- Task Content -->
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2 mb-1">
                                    <h4
                                        class="font-medium text-sm truncate"
                                        :class="task.status === 'done' ? 'text-white/40 line-through' : 'text-white'"
                                        x-text="task.title"
                                    ></h4>
                                    <span
                                        x-show="task.priority === 'urgent'"
                                        class="shrink-0 px-1.5 py-0.5 text-[10px] font-bold uppercase bg-red-500/20 text-red-400 rounded"
                                    >Urgent</span>
                                    <span
                                        x-show="task.priority === 'high'"
                                        class="shrink-0 px-1.5 py-0.5 text-[10px] font-bold uppercase bg-amber-500/20 text-amber-400 rounded"
                                    >High</span>
                                </div>
                                <p class="text-xs text-white/40 truncate" x-text="task.description || 'No description'"></p>

                                <!-- Task Meta -->
                                <div class="flex items-center gap-3 mt-2">
                                    <!-- Assignee Avatars -->
                                    <div class="flex -space-x-1" x-show="task.assignee_ids && task.assignee_ids.length > 0">
                                        <template x-for="assigneeId in (task.assignee_ids || []).slice(0, 3)" :key="assigneeId">
                                            <div
                                                class="w-5 h-5 rounded-full bg-gradient-to-br from-accent to-purple-500 ring-2 ring-[#1c1c1e] flex items-center justify-center text-[8px] font-bold text-white"
                                                x-text="getAgentInitial(assigneeId)"
                                                :title="getAgentName(assigneeId)"
                                            ></div>
                                        </template>
                                    </div>

                                    <!-- Tags -->
                                    <div class="flex gap-1" x-show="task.tags && task.tags.length > 0">
                                        <template x-for="tag in (task.tags || []).slice(0, 2)" :key="tag">
                                            <span class="text-[10px] text-white/30 bg-white/5 px-1.5 py-0.5 rounded" x-text="'#' + tag"></span>
                                        </template>
                                    </div>

                                    <!-- Time -->
                                    <span class="text-[10px] text-white/20 ml-auto" x-text="formatMCDate(task.created_at)"></span>
                                </div>
                            </div>

                            <!-- Running Indicator -->
                            <div
                                x-show="isMCTaskRunning(task.id)"
                                class="flex items-center gap-2"
                            >
                                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                <span class="text-[10px] text-green-400 font-medium">Running</span>
                            </div>

                            <!-- Actions -->
                            <div class="flex items-center gap-1" :class="isMCTaskRunning(task.id) ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'" style="transition: opacity 0.2s;">
                                <!-- Run Button (only show if has assignee and not running) -->
                                <button
                                    x-show="task.assignee_ids && task.assignee_ids.length > 0 && !isMCTaskRunning(task.id) && task.status !== 'done'"
                                    class="p-1.5 text-green-400/70 hover:text-green-400 hover:bg-green-500/10 rounded transition-all"
                                    @click.stop="runMCTask(task.id, task.assignee_ids[0])"
                                    title="Run Task"
                                >
                                    <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                </button>
                                <!-- Stop Button (only show if running) -->
                                <button
                                    x-show="isMCTaskRunning(task.id)"
                                    class="p-1.5 text-red-400/70 hover:text-red-400 hover:bg-red-500/10 rounded transition-all"
                                    @click.stop="stopMCTask(task.id)"
                                    title="Stop Task"
                                >
                                    <i data-lucide="square" class="w-3.5 h-3.5"></i>
                                </button>
                                <!-- Delete Button -->
                                <button
                                    x-show="!isMCTaskRunning(task.id)"
                                    class="p-1.5 text-white/30 hover:text-white hover:bg-white/10 rounded transition-all"
                                    @click.stop="deleteMCTask(task.id)"
                                    title="Delete"
                                >
                                    <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Right: Activity & Agents Panel -->
            <div class="w-80 lg:w-96 flex flex-col bg-black/20 overflow-hidden">

                <!-- Agents Section -->
                <div class="p-4 border-b border-white/5">
                    <h3 class="text-xs font-semibold text-white/40 uppercase tracking-wider mb-3">Agents</h3>
                    <div class="flex flex-wrap gap-2">
                        <template x-for="agent in missionControl.agents" :key="agent.id">
                            <div
                                class="flex items-center gap-2 px-2.5 py-1.5 rounded-lg transition-all cursor-pointer group"
                                :class="agent.status === 'active' ? 'bg-green-500/10 ring-1 ring-green-500/30' : 'bg-white/5 hover:bg-white/10'"
                                :title="agent.role + (agent.status === 'active' ? ' (Running)' : '')"
                            >
                                <div class="relative">
                                    <div
                                        class="w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-[10px] font-bold text-white"
                                        x-text="agent.name.charAt(0)"
                                    ></div>
                                    <div
                                        class="absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border-2 border-[#1c1c1e]"
                                        :class="{
                                            'bg-green-500 animate-pulse': agent.status === 'active',
                                            'bg-blue-500': agent.status === 'idle',
                                            'bg-amber-500': agent.status === 'blocked',
                                            'bg-gray-500': agent.status === 'offline'
                                        }"
                                    ></div>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs font-medium text-white/70 group-hover:text-white leading-tight" x-text="agent.name"></span>
                                    <span
                                        x-show="agent.status === 'active'"
                                        class="text-[9px] text-green-400 leading-tight"
                                    >Working...</span>
                                </div>
                                <button
                                    class="ml-auto opacity-0 group-hover:opacity-100 p-0.5 text-white/30 hover:text-red-400 transition-all"
                                    @click.stop="deleteMCAgent(agent.id)"
                                    x-show="agent.status !== 'active'"
                                >
                                    <i data-lucide="x" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </template>
                        <!-- Empty State -->
                        <div x-show="missionControl.agents.length === 0" class="w-full text-center py-3 text-white/30 text-xs">
                            No agents yet
                        </div>
                    </div>
                </div>

                <!-- Activity Feed -->
                <div class="flex-1 flex flex-col overflow-hidden">
                    <h3 class="text-xs font-semibold text-white/40 uppercase tracking-wider px-4 py-3 border-b border-white/5">Activity</h3>
                    <div class="flex-1 overflow-y-auto p-4 space-y-3">
                        <!-- Empty State -->
                        <div x-show="missionControl.activities.length === 0" class="flex flex-col items-center justify-center h-32 text-white/30">
                            <i data-lucide="activity" class="w-8 h-8 mb-2 opacity-40"></i>
                            <p class="text-xs">No activity yet</p>
                        </div>

                        <template x-for="activity in missionControl.activities.slice(0, 20)" :key="activity.id">
                            <div class="flex gap-3 animate-[fadeIn_0.3s_ease-out]">
                                <div
                                    class="mt-1 w-6 h-6 rounded-full flex items-center justify-center shrink-0"
                                    :class="{
                                        'bg-green-500/20 text-green-400': activity.type.includes('created'),
                                        'bg-blue-500/20 text-blue-400': activity.type.includes('updated') || activity.type.includes('status'),
                                        'bg-purple-500/20 text-purple-400': activity.type.includes('message'),
                                        'bg-amber-500/20 text-amber-400': activity.type.includes('assigned')
                                    }"
                                >
                                    <i
                                        :data-lucide="activity.type.includes('created') ? 'plus' : activity.type.includes('message') ? 'message-circle' : 'refresh-cw'"
                                        class="w-3 h-3"
                                    ></i>
                                </div>
                                <div class="min-w-0">
                                    <p class="text-xs text-white/70 leading-relaxed" x-text="activity.message"></p>
                                    <span class="text-[10px] text-white/30" x-text="formatMCDate(activity.created_at)"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Task Detail Panel (when task selected) -->
                <div
                    x-show="missionControl.selectedTask"
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="translate-y-full opacity-0"
                    x-transition:enter-end="translate-y-0 opacity-100"
                    class="absolute bottom-0 right-0 w-80 lg:w-96 bg-[#1c1c1e]/95 backdrop-blur-xl border-t border-l border-white/10 rounded-tl-2xl max-h-[60%] flex flex-col"
                >
                    <div class="flex items-center justify-between p-4 border-b border-white/5">
                        <h3 class="text-sm font-semibold text-white">Task Details</h3>
                        <button
                            class="p-1.5 text-white/50 hover:text-white hover:bg-white/10 rounded-lg transition-all"
                            @click="missionControl.selectedTask = null"
                        >
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-4">
                        <template x-if="missionControl.selectedTask">
                            <div class="space-y-4">
                                <div>
                                    <h4 class="font-semibold text-white mb-1" x-text="missionControl.selectedTask.title"></h4>
                                    <p class="text-sm text-white/50" x-text="missionControl.selectedTask.description || 'No description'"></p>
                                </div>

                                <!-- Status Selector -->
                                <div class="flex items-center gap-2">
                                    <span class="text-xs text-white/40 w-16">Status</span>
                                    <select
                                        class="flex-1 bg-white/5 border border-white/10 rounded-lg px-3 py-1.5 text-xs text-white focus:outline-none focus:border-accent"
                                        x-model="missionControl.selectedTask.status"
                                        @change="updateMCTaskStatus(missionControl.selectedTask.id, missionControl.selectedTask.status)"
                                    >
                                        <option value="inbox">Inbox</option>
                                        <option value="assigned">Assigned</option>
                                        <option value="in_progress">In Progress</option>
                                        <option value="review">Review</option>
                                        <option value="done">Done</option>
                                        <option value="blocked">Blocked</option>
                                    </select>
                                </div>

                                <!-- Priority -->
                                <div class="flex items-center gap-2">
                                    <span class="text-xs text-white/40 w-16">Priority</span>
                                    <div class="flex gap-1">
                                        <button
                                            class="px-2 py-1 text-[10px] rounded transition-all"
                                            :class="missionControl.selectedTask.priority === 'low' ? 'bg-gray-500/30 text-gray-300' : 'bg-white/5 text-white/40 hover:bg-white/10'"
                                            @click="updateMCTaskPriority(missionControl.selectedTask.id, 'low')"
                                        >Low</button>
                                        <button
                                            class="px-2 py-1 text-[10px] rounded transition-all"
                                            :class="missionControl.selectedTask.priority === 'medium' ? 'bg-blue-500/30 text-blue-300' : 'bg-white/5 text-white/40 hover:bg-white/10'"
                                            @click="updateMCTaskPriority(missionControl.selectedTask.id, 'medium')"
                                        >Medium</button>
                                        <button
                                            class="px-2 py-1 text-[10px] rounded transition-all"
                                            :class="missionControl.selectedTask.priority === 'high' ? 'bg-amber-500/30 text-amber-300' : 'bg-white/5 text-white/40 hover:bg-white/10'"
                                            @click="updateMCTaskPriority(missionControl.selectedTask.id, 'high')"
                                        >High</button>
                                        <button
                                            class="px-2 py-1 text-[10px] rounded transition-all"
                                            :class="missionControl.selectedTask.priority === 'urgent' ? 'bg-red-500/30 text-red-300' : 'bg-white/5 text-white/40 hover:bg-white/10'"
                                            @click="updateMCTaskPriority(missionControl.selectedTask.id, 'urgent')"
                                        >Urgent</button>
                                    </div>
                                </div>

                                <!-- Run/Stop Button -->
                                <div class="flex items-center gap-2 pt-2">
                                    <button
                                        x-show="missionControl.selectedTask.assignee_ids && missionControl.selectedTask.assignee_ids.length > 0 && !isMCTaskRunning(missionControl.selectedTask.id) && missionControl.selectedTask.status !== 'done'"
                                        class="flex items-center gap-2 px-4 py-2 bg-green-500/20 hover:bg-green-500/30 text-green-400 rounded-lg text-sm font-medium transition-all"
                                        @click="runMCTask(missionControl.selectedTask.id, missionControl.selectedTask.assignee_ids[0])"
                                    >
                                        <i data-lucide="play" class="w-4 h-4"></i>
                                        Run Task
                                    </button>
                                    <button
                                        x-show="isMCTaskRunning(missionControl.selectedTask.id)"
                                        class="flex items-center gap-2 px-4 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 rounded-lg text-sm font-medium transition-all"
                                        @click="stopMCTask(missionControl.selectedTask.id)"
                                    >
                                        <i data-lucide="square" class="w-4 h-4"></i>
                                        Stop
                                    </button>
                                    <span
                                        x-show="!missionControl.selectedTask.assignee_ids || missionControl.selectedTask.assignee_ids.length === 0"
                                        class="text-xs text-white/40"
                                    >
                                        Assign an agent to run this task
                                    </span>
                                </div>

                                <!-- Live Output Panel -->
                                <div
                                    x-show="isMCTaskRunning(missionControl.selectedTask.id) || missionControl.liveOutput"
                                    class="pt-3"
                                >
                                    <div class="flex items-center gap-2 mb-2">
                                        <div x-show="isMCTaskRunning(missionControl.selectedTask.id)" class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                        <span class="text-xs text-white/40 uppercase tracking-wider font-semibold">Live Output</span>
                                    </div>
                                    <div
                                        x-ref="liveOutputPanel"
                                        class="bg-black/40 rounded-lg p-3 max-h-48 overflow-y-auto font-mono text-xs text-white/70 whitespace-pre-wrap"
                                    >
                                        <span x-text="missionControl.liveOutput || 'Waiting for output...'"></span>
                                        <span x-show="isMCTaskRunning(missionControl.selectedTask.id)" class="inline-block w-2 h-4 bg-green-500 animate-pulse ml-0.5"></span>
                                    </div>
                                </div>

                                <!-- Timestamps -->
                                <div class="pt-3 border-t border-white/5 text-[10px] text-white/30 space-y-1">
                                    <p>Created <span x-text="formatMCDate(missionControl.selectedTask.created_at)"></span></p>
                                    <p x-show="missionControl.selectedTask.started_at">Started <span x-text="formatMCDate(missionControl.selectedTask.started_at)"></span></p>
                                    <p x-show="missionControl.selectedTask.completed_at">Completed <span x-text="formatMCDate(missionControl.selectedTask.completed_at)"></span></p>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Task Modal -->
    <div
        x-show="missionControl.showCreateTask"
        x-transition.opacity
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4"
        @click.self="missionControl.showCreateTask = false"
    >
        <div
            class="w-full max-w-lg bg-[#1c1c1e] border border-white/10 rounded-2xl shadow-2xl"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="scale-95 opacity-0"
            x-transition:enter-end="scale-100 opacity-100"
            @click.stop
        >
            <div class="flex items-center justify-between px-6 py-4 border-b border-white/5">
                <h3 class="text-base font-semibold text-white">New Task</h3>
                <button class="p-2 text-white/50 hover:text-white hover:bg-white/10 rounded-lg" @click="missionControl.showCreateTask = false">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <input
                    type="text"
                    x-model="missionControl.taskForm.title"
                    placeholder="Task title"
                    class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-sm text-white focus:outline-none focus:border-accent placeholder-white/30"
                    @keydown.enter="createMCTask()"
                >
                <textarea
                    x-model="missionControl.taskForm.description"
                    placeholder="Description (optional)"
                    rows="3"
                    class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-sm text-white focus:outline-none focus:border-accent placeholder-white/30 resize-none"
                ></textarea>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] text-white/40 uppercase tracking-wider mb-2 block">Priority</label>
                        <select
                            x-model="missionControl.taskForm.priority"
                            class="w-full bg-white/5 border border-white/10 rounded-lg py-2.5 px-3 text-sm text-white focus:outline-none focus:border-accent"
                        >
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] text-white/40 uppercase tracking-wider mb-2 block">Assign to</label>
                        <select
                            x-model="missionControl.taskForm.assignee"
                            class="w-full bg-white/5 border border-white/10 rounded-lg py-2.5 px-3 text-sm text-white focus:outline-none focus:border-accent"
                        >
                            <option value="">Unassigned</option>
                            <template x-for="agent in missionControl.agents" :key="agent.id">
                                <option :value="agent.id" x-text="agent.name"></option>
                            </template>
                        </select>
                    </div>
                </div>
                <input
                    type="text"
                    x-model="missionControl.taskForm.tags"
                    placeholder="Tags (comma-separated)"
                    class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-sm text-white focus:outline-none focus:border-accent placeholder-white/30"
                >
                <button
                    class="w-full py-3 bg-accent hover:bg-accent/90 text-white font-medium rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                    @click="createMCTask()"
                    :disabled="!missionControl.taskForm.title"
                >
                    Create Task
                </button>
            </div>
        </div>
    </div>

    <!-- Create Agent Modal -->
    <div
        x-show="missionControl.showCreateAgent"
        x-transition.opacity
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4"
        @click.self="missionControl.showCreateAgent = false"
    >
        <div
            class="w-full max-w-lg bg-[#1c1c1e] border border-white/10 rounded-2xl shadow-2xl"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="scale-95 opacity-0"
            x-transition:enter-end="scale-100 opacity-100"
            @click.stop
        >
            <div class="flex items-center justify-between px-6 py-4 border-b border-white/5">
                <h3 class="text-base font-semibold text-white">New Agent</h3>
                <button class="p-2 text-white/50 hover:text-white hover:bg-white/10 rounded-lg" @click="missionControl.showCreateAgent = false">
                    <i data-lucide="x" class="w-4 h-4"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <input
                    type="text"
                    x-model="missionControl.agentForm.name"
                    placeholder="Agent name (e.g., Jarvis)"
                    class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-sm text-white focus:outline-none focus:border-accent placeholder-white/30"
                >
                <input
                    type="text"
                    x-model="missionControl.agentForm.role"
                    placeholder="Role (e.g., Research Lead)"
                    class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-sm text-white focus:outline-none focus:border-accent placeholder-white/30"
                >
                <textarea
                    x-model="missionControl.agentForm.description"
                    placeholder="What does this agent do?"
                    rows="2"
                    class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-sm text-white focus:outline-none focus:border-accent placeholder-white/30 resize-none"
                ></textarea>
                <input
                    type="text"
                    x-model="missionControl.agentForm.specialties"
                    placeholder="Specialties (comma-separated)"
                    class="w-full bg-white/5 border border-white/10 rounded-xl py-3 px-4 text-sm text-white focus:outline-none focus:border-accent placeholder-white/30"
                >
                <button
                    class="w-full py-3 bg-accent hover:bg-accent/90 text-white font-medium rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                    @click="createMCAgent()"
                    :disabled="!missionControl.agentForm.name || !missionControl.agentForm.role"
                >
                    Create Agent
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-4px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
