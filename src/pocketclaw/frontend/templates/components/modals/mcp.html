<!--
  PocketPaw Dashboard - MCP Servers Modal

  Created: 2026-02-07
  Manage MCP (Model Context Protocol) server connections.
-->
<!-- MCP Modal -->
<div
  class="fixed inset-0 z-[100] flex items-center justify-center bg-black/40 backdrop-blur-md p-4"
  x-show="showMCP"
  x-transition.opacity
  @click.self="showMCP = false"
>
<div class="w-full max-w-[620px] flex flex-col bg-[#1c1c1e]/95 backdrop-blur-xl border border-[var(--glass-border)] rounded-[20px] shadow-2xl animate-[modalPop_0.25s_ease-out] overflow-hidden max-h-[90vh]" @click.stop>
    <!-- Header -->
    <div class="flex items-center justify-between px-6 py-5 border-b border-[var(--glass-border)] shrink-0">
        <div class="flex items-center gap-3">
            <i data-lucide="plug" class="w-5 h-5 text-accent"></i>
            <h2 class="text-[17px] font-semibold">MCP Servers</h2>
        </div>
        <button class="p-2 -mr-2 text-[var(--text-secondary)] hover:text-white hover:bg-white/10 rounded-lg transition-colors" @click="showMCP = false">
            <i data-lucide="x" class="w-5 h-5"></i>
        </button>
    </div>

    <div class="p-6 overflow-y-auto flex flex-col gap-5">
        <!-- Server List -->
        <template x-if="Object.keys(mcpServers).length > 0">
            <div class="flex flex-col gap-3">
                <template x-for="(info, name) in mcpServers" :key="name">
                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-xl border border-white/5">
                        <span
                            class="w-2.5 h-2.5 rounded-full shrink-0"
                            :class="info.connected ? 'bg-[var(--success-color)]' : 'bg-white/20'"
                        ></span>
                        <div class="flex-1 min-w-0">
                            <div class="font-medium text-[13px] truncate" x-text="name"></div>
                            <div class="text-[11px] text-white/40" x-text="info.connected ? info.tool_count + ' tools' : (info.error || 'disconnected')"></div>
                        </div>
                        <div class="flex items-center gap-1.5">
                            <button
                                class="p-1.5 text-white/40 hover:text-white hover:bg-white/10 rounded-lg transition-colors"
                                @click="toggleMCPServer(name)"
                                :title="info.connected ? 'Disable' : 'Enable'"
                            >
                                <i :data-lucide="info.connected ? 'pause' : 'play'" class="w-4 h-4"></i>
                            </button>
                            <button
                                class="p-1.5 text-white/40 hover:text-[var(--danger-color)] hover:bg-[var(--danger-color)]/10 rounded-lg transition-colors"
                                @click="removeMCPServer(name)"
                                title="Remove"
                            >
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </template>

        <template x-if="Object.keys(mcpServers).length === 0">
            <div class="text-center py-8 text-white/40 text-[13px]">
                No MCP servers configured. Add one below.
            </div>
        </template>

        <!-- Add Server Form -->
        <div class="border-t border-[var(--glass-border)] pt-5">
            <h3 class="text-[13px] font-semibold text-white/70 mb-3">Add Server</h3>
            <div class="flex flex-col gap-3">
                <div class="flex gap-3">
                    <input
                        type="text"
                        x-model="mcpForm.name"
                        placeholder="Server name (e.g. filesystem)"
                        class="flex-1 px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-[13px] focus:border-accent focus:outline-none"
                    />
                    <select
                        x-model="mcpForm.transport"
                        class="px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-[13px] focus:border-accent focus:outline-none"
                    >
                        <option value="stdio">stdio</option>
                        <option value="http">http</option>
                    </select>
                </div>
                <template x-if="mcpForm.transport === 'stdio'">
                    <div class="flex flex-col gap-3">
                        <input
                            type="text"
                            x-model="mcpForm.command"
                            placeholder="Command (e.g. npx)"
                            class="px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-[13px] focus:border-accent focus:outline-none"
                        />
                        <input
                            type="text"
                            x-model="mcpForm.args"
                            placeholder="Args (comma-separated, e.g. -y,@mcp/server-fs,/home)"
                            class="px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-[13px] focus:border-accent focus:outline-none"
                        />
                    </div>
                </template>
                <template x-if="mcpForm.transport === 'http'">
                    <input
                        type="text"
                        x-model="mcpForm.url"
                        placeholder="Server URL (e.g. http://localhost:9000)"
                        class="px-3 py-2 bg-white/5 border border-white/10 rounded-lg text-[13px] focus:border-accent focus:outline-none"
                    />
                </template>
                <button
                    @click="addMCPServer()"
                    :disabled="mcpLoading || !mcpForm.name"
                    class="px-4 py-2.5 bg-accent/20 text-accent font-medium rounded-xl hover:bg-accent/30 transition-colors disabled:opacity-50 text-[13px]"
                >
                    <span x-show="!mcpLoading">Add Server</span>
                    <span x-show="mcpLoading">Adding...</span>
                </button>
            </div>
        </div>
    </div>
</div>
</div>
